{
    "collab_server" : "",
    "contents" : "rm(list=ls())\nlibrary(snow)\nlibrary(doParallel)\nlibrary(foreach)\n\n\nset.seed(123)\n#======================================================================\n# Diagnostic quantity\n#======================================================================\nd = c(400) # no. of particles\nN = c(1000)     # no. of IS estimates\ntunpar = matrix(c(rep(d, each = length(N)), rep(N, length(d))), ncol = 2)\n\n\n\n### set up for parallelization\nnprocs = 19\nmp_type = \"MPI\"\n# mp_type = \"PSOCK\"\ncl = parallel::makeCluster(nprocs, type=mp_type)\ndoParallel::registerDoParallel(cl)\n\n\n\nfor(k in 1:nrow(tunpar)){\n  load(paste(\"simzLikEmd\", tunpar[k,1], \"N\", tunpar[k,2], \".RData\", sep = \"\"))\n  \n  regint = seq(1000, nrow(LikEm), by = 1000)\n  idx = sapply(regint, function(i) which(LikEm[i,1] == th[,1]))\n  \n  ptm = proc.time()[3]\n  bart = foreach(j = idx, .combine = 'rbind') %dopar% {\n    \n    m = which(idx == j)\n    n = regint[m]\n    qn = sapply(1:j, function(i) sum(th[i,1]==LikEm[1:n,1])/n)\n    \n    \n    # I Tilda\n    Iii = t(qn) %*% ( zLikEm[1:j,1:2] - (zLikEm[1:j,3:4])^2 )\n    Iij = t(qn) %*% ( zLikEm[1:j,5] - zLikEm[1:j,3]*zLikEm[1:j,4] )\n    I = matrix(c(Iii[1], rep(Iij, 2), Iii[2]), ncol = 2)\n    \n    # J Tilda\n    uhat = t(sapply(1:j, function(ell) stat - zLikEm[ell,3:4]))\n    Jii = t(qn) %*% (uhat^2)\n    Jij = t(qn) %*% (uhat[,1]*uhat[,2])\n    J = matrix(c(Jii[1], rep(Jij, 2), Jii[2]), ncol = 2)\n    \n    \n    ### I^{-1}J - diag(p)\n    invfnorm = sqrt(sum((solve(I)%*%J - diag(2))^2))\n    invmnorm = max(abs(solve(I)%*%J - diag(2)))\n    \n    inv2fnorm = sqrt(sum((solve(J)%*%I - diag(2))^2))\n    inv2mnorm = max(abs(solve(J)%*%I - diag(2)))\n    \n    ### I - J\n    diffnorm = sqrt(sum((I-J)^2))\n    difmnorm = max(abs(I-J))\n    \n    c(invfnorm, invmnorm, inv2fnorm, inv2mnorm, diffnorm, difmnorm)\n  }\n  timebart = proc.time()[3] - ptm\n  save(regint, bart, file = paste(\"simB2LikEmd\", tunpar[k,1], \"N\", tunpar[k,2], \".RData\", sep = \"\"))\n}\n\n\n",
    "created" : 1608318216157.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3861080415",
    "id" : "6C3C3A5F",
    "lastKnownWriteTime" : 1608355907,
    "last_content_update" : 1608355907437,
    "path" : "~/work/diagnostics/ergm/magnolia/b2LikEm.R",
    "project_path" : "b2LikEm.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}