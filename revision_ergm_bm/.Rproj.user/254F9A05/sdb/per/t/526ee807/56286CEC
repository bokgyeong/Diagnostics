{
    "collab_server" : "",
    "contents" : "rm(list=ls())\nlibrary(coda)\nlibrary(ergm)\nlibrary(Rcpp)\nlibrary(RcppArmadillo)\nlibrary(MASS)\nlibrary(snow)\nlibrary(doParallel)\nlibrary(foreach)\nSys.setenv(\"PKG_CXXFLAGS\"=\"-fopenmp\")\nSys.setenv(\"PKG_LIBS\"=\"-fopenmp\")\n\n\nset.seed(123)\n#======================================================================\n# Call data and functions\n#======================================================================\nload(\"simLikEm.RData\")\nsourceCpp(\"RcppFtns.cpp\")\n\n\n\n#======================================================================\n# Compute the approximate score statistics\n#======================================================================\nLikEm = LikEm[[which(tunpar[,1] == 100 & tunpar[,2] == 1000)]]\nburn = 10000\n# niter = nrow(LikEm)\nniter = 50000\nLikEm = LikEm[(burn+1):niter,]\nth = unique(LikEm)\nnth = nrow(th)\n\n\n\n# ### for thining\n# LikEm = LikEm[[which(tunpar[,1] == 100 & tunpar[,2] == 1000)]]\n# burn = 10000\n# niter = nrow(LikEm)\n# LikEm = LikEm[seq(burn+50, niter, by = 50),]\n# th = unique(LikEm)\n# nth = nrow(th)\n\n\n\nN = 2000 # the number of y's to approximate score statistic\nn = nrow(LikEm)\nthhat = colMeans(LikEm)\n\n\n### Set up for foreach\nnprocs = 19\nmp_type = \"MPI\"\n# mp_type = \"PSOCK\"\ncl = parallel::makeCluster(nprocs, type=mp_type)\ndoParallel::registerDoParallel(cl)\n\n\n### Simulate datasets and compute their summary statistics\nptm = proc.time()[3]\nzLikEm = foreach::foreach(i = 1:nth, .combine = rbind, .packages = \"Rcpp\", .noexport = c(\"Choose\", \"countShared\", \"Gibbs\", \"pResponseErgm\", \"Summary\")) %dopar% {\n  sourceCpp(\"RcppFtns.cpp\")\n  \n  Ystat = pResponseErgm(X, 100, thhat, N, 1) # 100 cycles of Gibbs\n  nw = exp(Ystat %*% (th[i,] - thhat))\n  w = nw/sum(nw)\n  \n  z1 = t(w)%*%(Ystat^2) \n  z2 = t(w)%*%(Ystat)\n  z3 = t(w)%*%(Ystat[,1]*Ystat[,2])\n  c(z1, z2, z3)\n}\ntimezLikEm = proc.time()[3] - ptm\n\nsave(LikEm, th, nth, stat, zLikEm, timezLikEm, file = \"simzLikEmd100N1000.RData\")\n\n\n",
    "created" : 1607999264051.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "733872170",
    "id" : "56286CEC",
    "lastKnownWriteTime" : 1607999267,
    "last_content_update" : 1607999267522,
    "path" : "~/work/diagnostics/ergm/magnolia/zFuncEmd100N1000.R",
    "project_path" : "zFuncEmd100N1000.R",
    "properties" : {
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}