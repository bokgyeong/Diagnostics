{
    "collab_server" : "",
    "contents" : "rm(list=ls())\nlibrary(fields)\nlibrary(lattice)\nlibrary(coda)\nlibrary(Rcpp)\nlibrary(RcppArmadillo)\nlibrary(xtable)\nlibrary(snow)\nlibrary(doParallel)\nlibrary(foreach)\nSys.setenv(\"PKG_CXXFLAGS\"=\"-fopenmp\")\nSys.setenv(\"PKG_LIBS\"=\"-fopenmp\")\n\n#========================================================================\n# Call a dataset, saved images, and functions\n#========================================================================\n# load(\"isingData020.RData\")\n# load(\"Liang020.RData\")\nload(\"isingData020n30.RData\")\nload(\"Liang020n30.RData\")\n\nsource(\"http://personal.psu.edu/muh10/MCMCtut/batchmeans.R\")\nsource(\"RFtns.R\")\nsourceCpp(\"RcppFtns.cpp\")\n\n\n#========================================================================\n# Approximate score and hessian\n#========================================================================\nLiang = Liang[[which(Nin==100)]]\nburn = 10000\n# niter = 50000\nniter = 100000\nLiang = Liang[(burn+1):niter,]\nth = unique(Liang)\nnth = length(th)\n\n\n# ### for thining\n# Liang = Liang[[which(Nin==100)]]\n# burn = 10000\n# niter = nrow(Liang)\n# Liang = Liang[seq(burn+50, niter, by = 50),]\n# th = unique(Liang)\n# nth = length(th)\n\n\n\nN = 1000 # no of simulated datasets used to approximate the score statistic\nlsize = nrow(X)\nSx = Energy(X) # Summary statistic of the observed data\n\n\n### set up for paralellization\nnprocs = 19\n# mp_type = \"MPI\"\nmp_type = \"PSOCK\"\ncl = parallel::makeCluster(nprocs, type=mp_type)\ndoParallel::registerDoParallel(cl)\n\n\n### simulation by perfect sampler\nptm = proc.time()[3]\nzLiangIn100 = foreach::foreach(i = 1:nth, .combine = rbind, .packages = \"Rcpp\", .noexport = c(\"Energe\", \"pAuxStatPerf\", \"ProppWilson\")) %dopar% {\n  sourceCpp(\"RcppFtns.cpp\")\n  Sys = pAuxStatPerf(lsize, lsize, th[i], N, 1)\n  z1 = colMeans(Sys^2) \n  z2 = colMeans(Sys)\n  c(z1, z2)\n}\ntimezLiangIn100 = proc.time()[3] - ptm\n# save(Liang, th, nth, Sx, zLiangIn100, timezLiangIn100, file = \"zLiang020In100Perf.RData\")\n# save(Liang, th, nth, Sx, zLiangIn100, timezLiangIn100, file = \"zLiang020n30In100Perf.RData\")\n# save(Liang, th, nth, Sx, zLiangIn100, timezLiangIn100, file = \"zLiang020n30In100Perf_thin.RData\")\nsave(Liang, th, nth, Sx, zLiangIn100, timezLiangIn100, file = \"zLiang020n30In100Perf_long.RData\")\n\n",
    "created" : 1603240330106.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "458434434",
    "id" : "6221847",
    "lastKnownWriteTime" : 1602617518,
    "last_content_update" : 1602617518,
    "path" : "~/work/approxKSD/ising/zLiangIn100.R",
    "project_path" : "zLiangIn100.R",
    "properties" : {
    },
    "relative_order" : 16,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}