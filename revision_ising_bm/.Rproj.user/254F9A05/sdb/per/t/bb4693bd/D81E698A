{
    "collab_server" : "",
    "contents" : "rm(list=ls())\nlibrary(snow)\nlibrary(doParallel)\nlibrary(foreach)\n# library(coda)\n# source(\"http://personal.psu.edu/muh10/MCMCtut/batchmeans.R\")\n#------------------------------------------------------------------------\n# load\n#------------------------------------------------------------------------\n# load(\"zLiang020In1Perf.RData\")\n# load(\"zLiang020In3Perf.RData\")\n# load(\"zLiang020In5Perf.RData\")\n# load(\"zLiang020In10Perf.RData\")\n# load(\"zLiang020In30Perf.RData\")\n# load(\"zLiang020In50Perf.RData\")\n# load(\"zLiang020In70Perf.RData\")\n# load(\"zLiang020In100Perf.RData\")\n# load(\"Liang020.RData\")\n\n\n# load(\"zLiang020In3Perf_thin.RData\")\n# load(\"zLiang020In10Perf_thin.RData\")\n# load(\"zLiang020In50Perf_thin.RData\")\n# load(\"Liang020In3_thin.RData\"); LiangIn3 = Liang\n# load(\"Liang020In10_thin.RData\"); LiangIn10 = Liang\n# load(\"Liang020In50_thin.RData\"); LiangIn50 = Liang\n\n\n# load(\"zLiang020n30In1Perf.RData\")\n# load(\"zLiang020n30In3Perf.RData\")\n# load(\"zLiang020n30In5Perf.RData\")\n# load(\"zLiang020n30In10Perf.RData\")\n# load(\"zLiang020n30In30Perf.RData\")\n# load(\"zLiang020n30In50Perf.RData\")\n# load(\"zLiang020n30In70Perf.RData\")\n# load(\"zLiang020n30In100Perf.RData\")\n# load(\"Liang020n30.RData\")\n\n\n# load(\"zLiang020n30In1Perf_thin.RData\")\n# load(\"zLiang020n30In3Perf_thin.RData\")\n# load(\"zLiang020n30In5Perf_thin.RData\")\n# load(\"zLiang020n30In10Perf_thin.RData\")\n# load(\"zLiang020n30In30Perf_thin.RData\")\n# load(\"zLiang020n30In50Perf_thin.RData\")\n# load(\"zLiang020n30In70Perf_thin.RData\")\n# load(\"zLiang020n30In100Perf_thin.RData\")\n# load(\"Liang020n30.RData\")\n\n\nload(\"zLiang020n30In1Perf_long.RData\")\nload(\"zLiang020n30In3Perf_long.RData\")\nload(\"zLiang020n30In5Perf_long.RData\")\nload(\"zLiang020n30In10Perf_long.RData\")\nload(\"zLiang020n30In30Perf_long.RData\")\nload(\"zLiang020n30In50Perf_long.RData\")\nload(\"zLiang020n30In70Perf_long.RData\")\nload(\"zLiang020n30In100Perf_long.RData\")\nload(\"Liang020n30.RData\")\n\n\n#------------------------------------------------------------------------\n# compute the diagnostic quantity\n#------------------------------------------------------------------------\nz = list(zLiangIn1, zLiangIn3, zLiangIn5, zLiangIn10, zLiangIn30, zLiangIn50, zLiangIn70, zLiangIn100)\n# z = list(zLiangIn3, zLiangIn10, zLiangIn50)\n# Liang = list(LiangIn3, LiangIn10, LiangIn50)\n\n### set up for parallelization\nnprocs = 19\nmp_type = \"MPI\"\n# mp_type = \"PSOCK\"\ncl = parallel::makeCluster(nprocs, type=mp_type)\ndoParallel::registerDoParallel(cl)\n\n\nptm = proc.time()[3]\nbartLiang = foreach::foreach(k = 1:length(z)) %dopar% {\n  LiangInk = Liang[[k]]\n  \n  burn = 10000\n  # niter = 50000\n  niter = 100000\n  LiangInk = LiangInk[(burn+1):niter,]\n  th = unique(LiangInk)\n  nth = length(th)\n\n  # # for thining\n  # burn = 10000\n  # niter = nrow(LiangInk)\n  # LiangInk = LiangInk[seq(burn+50, niter, by = 50),]\n  # th = unique(LiangInk)\n  # nth = length(th)\n  \n  regint = seq(1000, length(LiangInk), by = 100)\n  idx = sapply(regint, function(i) which(LiangInk[i] == th))\n  bart = rep(0, length(idx))\n  \n  for(j in idx){\n    m = which(idx == j)\n    n = regint[m]\n    qn = sapply(1:j, function(i) sum(th[i]==LiangInk[1:n])/n)\n    \n    # estimate of the information matrix I(theta)\n    Ihat = sum((z[[k]][1:j,1] - (z[[k]][1:j,2])^2)*qn)\n    \n    # estimate of the J(theta)\n    Uhat = sapply(1:j, function(ell) Sx - z[[k]][ell,2])\n    Jhat = sum((Uhat^2)*qn)\n    \n    bart[m] = sqrt((Ihat/Jhat - 1)^2)\n  }\n  bart\n}\ntimebartLiang = proc.time()[3] - ptm\n\nburn = 10000\n# niter = 50000\nniter = 100000\nregint = seq(1000, length(Liang[[1]][(burn+1):niter,]), by = 100)\n\n# # for thining\n# burn = 10000\n# niter = nrow(Liang[[1]])\n# regint = seq(1000, length(seq(burn+50, niter, by = 50)), by = 100)\n\n# save(regint, bartLiang, timebartLiang, file = \"bartLiang020Perf.RData\")\n# save(regint, bartLiang, timebartLiang, file = \"bartLiang020Perf_thin.RData\")\n# save(regint, bartLiang, timebartLiang, file = \"bartLiang020n30Perf.RData\")\n# save(regint, bartLiang, timebartLiang, file = \"bartLiang020n30Perf_thin.RData\")\nsave(regint, bartLiang, timebartLiang, file = \"bartLiang020n30Perf_long.RData\")\n\n",
    "created" : 1602622412522.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "406319769",
    "id" : "D81E698A",
    "lastKnownWriteTime" : 1602622489,
    "last_content_update" : 1602622489236,
    "path" : "~/work/approxKSD/ising/bartLiang.R",
    "project_path" : "bartLiang.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}