{
    "collab_server" : "",
    "contents" : "rm(list=ls())\nlibrary(tidyverse)\nlibrary(gridExtra)\nget_legend<-function(myggplot){\n  tmp <- ggplot_gtable(ggplot_build(myggplot))\n  leg <- which(sapply(tmp$grobs, function(x) x$name) == \"guide-box\")\n  legend <- tmp$grobs[[leg]]\n  return(legend)\n}\n\n# ===================================================\n# Data preparation for Godambe and AIKSD\n# ===================================================\nm = c(1, 5, 50, 100)\n# m = c(5, 50, 100)\nburnIn = 10000\n\n### B2 ----------------------------------------------\nb2 = data.frame()\nfor(i in 1:length(m)){\n  load(paste(\"simB2LiangIn\", m[i], \".RData\", sep = \"\"))\n  df = data.frame(Algorithm = \"DMH (inexact)\", Tuning = paste(\"m=\", m[i], sep = \"\"), Inv = bart[,1], InvMod = bart[,2], Dif = bart[,3], Knots = burnIn + regint)\n  b2 = rbind(b2, df)\n}\nload(\"simB2Murray.RData\")\ndf = data.frame(Algorithm = \"Exchange (exact)\", Tuning = NA, Inv = bart[,1], InvMod = bart[,2], Dif = bart[,3], Knots = burnIn + regint)\nb2 = rbind(b2, df)\n\n\n\n\n### AIKSD ----------------------------------------------\naIKSD = data.frame()\nfor(i in 1:length(m)){\n  load(paste(\"simAIKSDLiangIn\", m[i], \".RData\", sep = \"\"))\n  df = data.frame(Algorithm = \"DMH (inexact)\", Tuning = paste(\"m=\", m[i], sep = \"\"), Values = aiksd, Knots = burnIn + regint)\n  aIKSD = rbind(aIKSD, df)\n}\nload(\"simAIKSDMurray.RData\")\ndf = data.frame(Algorithm = \"Exchange (exact)\", Tuning = NA, Values = aiksd, Knots = burnIn + regint)\naIKSD = rbind(aIKSD, df)\n\n\n\n\n\n\n# ===================================================\n# Visualization\n# ===================================================\n# ylimit = b2 %>%\n#   summarise(InvUp = max(Inv), DifUp = max(Dif))\n# ylimit = unlist(ylimit)\n\n# ylimit = c(0.7, 1500)\n\n### B2 - H^{-1}J - I ----------------------------------------------\npInv = ggplot(b2, aes(x = Knots, y = Inv)) +\n  geom_line(aes(color = Tuning, linetype = Algorithm)) +\n  # coord_cartesian(ylim = c(0, ylimit[1])) +\n  coord_cartesian(ylim = c(0, NA)) +\n  labs(title = expression(\"A=B. ||\"*H^-1*J - I*\"||\"), x = \"Sampe size\", y = \"Values\")\n\n\n# pDif = ggplot(b2, aes(x = Knots, y = Dif)) +\n#   geom_line(aes(color = Tuning, linetype = Algorithm)) +\n#   # coord_cartesian(ylim = c(0, ylimit[2])) +\n#   coord_cartesian(ylim = c(0, NA)) +\n#   labs(title = expression(\"E=F. ||\"*H - J*\"||\"), x = \"Sampe size\", y = \"Values\") +\n#   theme(legend.position=\"none\")\n\npDif = ggplot(b2, aes(x = Knots, y = Dif)) +\n  geom_line(aes(color = Tuning, linetype = Algorithm)) +\n  # coord_cartesian(ylim = c(0, ylimit[2])) +\n  coord_cartesian(ylim = c(0, NA)) +\n  labs(title = 'Curvature Diagnostic', x = \"Sampe size\", y = \"Values\") +\n  theme(legend.position=\"none\")\n\n\n### B2 - J^{-1}H - I ----------------------------------------------\npInvMod = ggplot(b2, aes(x = Knots, y = InvMod)) +\n  geom_line(aes(color = Tuning, linetype = Algorithm)) +\n  # coord_cartesian(ylim = c(0, ylimit[1])) +\n  coord_cartesian(ylim = c(0, NA)) +\n  labs(title = expression(\"C=D. ||\"*J^-1*H - I*\"||\"), x = \"Sampe size\", y = \"Values\") +\n  theme(legend.position=\"none\")\n\n\n### save the legend\nleg = get_legend(pInv)\n\n### Remove the legend\npInv = pInv + theme(legend.position=\"none\")\n\n### Arrange ggplot2 graphs with a specific width\n# grid.arrange(pInv, pInvMod, leg,\n#              layout_matrix = matrix(c(1, 2, 3), ncol = 3, byrow = T), widths = c(2.5, 2.5, 1.5))\n\ngrid.arrange(pInv, pInvMod, pDif, leg,\n             layout_matrix = matrix(c(1, 2, 3, 4), ncol = 4, byrow = T), widths = c(2.5, 2.5, 2.5, 1))\n\ngrid.arrange(pInv, pInvMod, leg,\n             layout_matrix = matrix(c(1, 2, 3), ncol = 3, byrow = T), widths = c(2.3, 2.3, 0.6))\n\n\n\n### AIKSD ----------------------------------------------\npAIKSD = ggplot(aIKSD, aes(x = Knots, y = Values)) +\n  geom_line(aes(color = Tuning, linetype = Algorithm)) +\n  coord_cartesian(ylim = c(0, NA)) +\n  labs(title = \"AIKS\", x = \"Sampe size\", y = \"Values\")\n  # labs(x = \"Sampe size\", y = \"Discrepancy\")\n\npAIKSD\n\n\n\n### B2 and AIKSD ----------------------------------------------\n# Remove the legend\npAIKSD = pAIKSD + theme(legend.position=\"none\")\n\ngrid.arrange(pInv, pAIKSD, leg, ncol = 3, widths = c(2.3, 2.3, 0.6))\n\ngrid.arrange(pInvMod, pAIKSD, leg, ncol = 3, widths = c(2.3, 2.3, 0.6))\n\ngrid.arrange(pDif, pAIKSD, leg, ncol = 3, widths = c(2.3, 2.3, 0.9))\n\n\n\n\n\n# =================================================\n# sample posterior distribution\n# =================================================\nlibrary(batchmeans)\nlibrary(coda)\nload(\"simLiang.RData\")\n\n### SE vs sample size plot ------------------------------\nburnIn = 0\nNiter = 20000\nseLiang = data.frame(m1 = sapply(1000:(Niter-burnIn), function(i) bm(Liang[[which(Nin == 1)]][1:i])$se),\n                     m50 = sapply(1000:(Niter-burnIn), function(i) bm(Liang[[which(Nin == 50)]][1:i])$se))\nyrange = c(min(seLiang), max(seLiang))\n\n\nseLiangIn1 = ggplot(seLiang, aes(x = 1000:(Niter-burnIn))) +\n  geom_line(aes(y = m1)) +\n  coord_cartesian(ylim = yrange) +\n  labs(title = 'DMH with m = 1', x = \"Sample size\", y = 'Standard error')\n\nseLiangIn50 = ggplot(seLiang, aes(x = 1000:(Niter-burnIn))) +\n  geom_line(aes(y = m50)) +\n  coord_cartesian(ylim = yrange) +\n  labs(title = 'DMH with m = 50', x = \"Sample size\", y = 'Standard error')\n\ngrid.arrange(seLiangIn1, seLiangIn50, ncol = 2, widths = c(2.3, 2.3))\n\n\n\n### Inference results ------------------------------------------\nburnIn = 10000\nNiter = 30000\n\nresult = matrix(0, nrow = 2, ncol = 2)\nrownames(result) = c('m=1', 'm=50')\ncolnames(result) = c('ESS', 'MCSE')\nm = c(1, 50)\nfor(i in 1:length(m)){\n  result[i,] = c(round(ess(Liang[[which(Nin == m[i])]][(burnIn+1):Niter]), 2), \n                 round(bm(Liang[[which(Nin == m[i])]][(burnIn+1):Niter])$se, 5))\n}\nresult\n\nload('grLiang.RData')\nLiang1 = sapply(1:3, function(i) mcmc(Liang[[i]]), simplify = F)\nLiang50 = sapply(4:6, function(i) mcmc(Liang[[i]]), simplify = F)\n\nRhat1 = gelman.diag(mcmc.list(Liang1))\nRhat50 = gelman.diag(mcmc.list(Liang50))\n\nround(c(Rhat1$psrf[1], Rhat50$psrf[1]), 4)\n",
    "created" : 1607899120386.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3889147737",
    "id" : "C38C616C",
    "lastKnownWriteTime" : 1611800020,
    "last_content_update" : 1611800020817,
    "path" : "~/work/diagnostics/ising/plotting.R",
    "project_path" : "plotting.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}